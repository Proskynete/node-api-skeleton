<div id="top">
  <h1>Node API Skeleton <img src="https://cdn.iconscout.com/icon/free/png-256/typescript-1174965.png" width="25" height="25" /></h1>
</div>

<p>This is a repository meant to serve as a starting point if you want to start a TypeScript express API project with some common features already set up and best practices.</p>
</div>

## Status

[![Coverage Status](https://img.shields.io/coverallsCoverage/github/Proskynete/node-api-skeleton?logo=Coveralls)](https://coveralls.io/github/Proskynete/node-api-skeleton?branch=master) [![CI](https://img.shields.io/github/actions/workflow/status/Proskynete/node-api-skeleton/ci.yml?logo=GithubActions&logoColor=fff)](https://github.com/Proskynete/node-api-skeleton/actions/workflows/ci.yml) [![GitHub issues](https://img.shields.io/github/issues/Proskynete/node-api-skeleton)](https://github.com/Proskynete/node-api-skeleton/issues) [![GitHub forks](https://img.shields.io/github/forks/Proskynete/node-api-skeleton)](https://github.com/Proskynete/node-api-skeleton/network) [![GitHub stars](https://img.shields.io/github/stars/Proskynete/node-api-skeleton)](https://github.com/Proskynete/node-api-skeleton/stargazers)  [![PRs welcome](https://img.shields.io/badge/PRs-welcome-green)](#CONTRIBUTING.md)

## ğŸš€ Migration to Modern Architecture

> **Note**: A comprehensive migration plan is available in the [`specs/`](./specs/) folder to transform this project into a modern, scalable architecture.

**Target Stack**: Fastify â€¢ SWC â€¢ Vitest â€¢ Zod â€¢ Winston â€¢ Hexagonal Architecture

**Highlights**:
- ğŸ—ï¸ Hexagonal + Onion + Screaming Architecture
- âš¡ Fastify (replacing Express) for better performance
- ğŸ”¥ SWC compiler (20x faster than tsc)
- ğŸ§ª Vitest for faster tests
- ğŸ¯ Hybrid approach: OOP for structure, FP for transformations
- ğŸ“¦ API versioning strategy (v1, v2, etc.)
- ğŸ“Š Observability with Winston + Prometheus

See **[specs/README.md](./specs/README.md)** for the complete migration roadmap and implementation plan.

<details>
  <summary>Table of contents</summary>
  <ol>
    <li>
      <a href="#features">Features</a>
    </li>
    <li>
      <a href="#folder-structure">Folder structure</a>
    </li>
    <li>
      <a href="#how-to-use">How to use</a>
    </li>
    <li>
      <a href="#docker">Docker</a>
    </li>
    <li>
      <a href="#linting">Linting</a>
    </li>
    <li>
      <a href="#testing">Testing</a>
    </li>
    <li>
      <a href="#coveralls">Coveralls</a>
    </li>
    <li>
      <a href="#migration-plan">Migration Plan</a>
    </li>
  </ol>
</details>

<h2 id="features">âš™ï¸ Features</h2>

- [Express](https://expressjs.com/)
- [TypeScript](https://www.typescriptlang.org/)
- [ts-node-dev](https://github.com/wclr/ts-node-dev)
- [Jest](https://jestjs.io/)
- [Cors](https://github.com/expressjs/cors)
- [Morgan](https://github.com/expressjs/morgan)
- [Helmet](https://helmetjs.github.io/)
- [Supertest](https://github.com/ladjs/supertest#readme)
- [ESLint](https://eslint.org/)
- [Prettier](https://prettier.io/)
- [Husky](https://typicode.github.io/husky/#/)
- [Github Actions](https://github.com/features/actions)
- [Docker](https://www.docker.com/)
- [Open API](https://swagger.io/specification/)

<p align="right"><a href="#top">ğŸ”</a></p>

<h2 id="folder-structure">ğŸ—‚ï¸ Folder structure</h2>

    .
    â”œâ”€â”€ .github/
    â”‚   â””â”€â”€ workflows/
    â”‚       â”œâ”€â”€ ci.yml          # Continuous integration workflow
    â”‚       â”œâ”€â”€ coveralls.yml   # Coveralls workflow
    â”‚       â”œâ”€â”€ lint.yml        # Linting workflow
    â”‚       â””â”€â”€ test.yml        # Testing workflow
    â”œâ”€â”€ .husky/                 # Husky configuration
    â”‚   â”œâ”€â”€ pre-commit          # Pre-commit hook    
    â”‚   â””â”€â”€ pre-push            # Pre-push hook
    â”œâ”€â”€ coverage/               # Coverage report generated by Jest (folder is ignored by git)
    â”œâ”€â”€ dist/                   # Transpiler files (folder is ignored by git)
    â”œâ”€â”€ src/
    â”‚   â”œâ”€â”€ controllers/        # Controllers define functions that respond to various http requests
    â”‚   â”‚   â””â”€â”€ ...
    â”‚   â”œâ”€â”€ models/             # Models define the structure
    â”‚   â”‚   â””â”€â”€ ...
    â”‚   â”œâ”€â”€ routes/             # Routes define the endpoints of the API
    â”‚   â”‚   â”œâ”€â”€ index.ts        # Index file that generates the prefix of the routes and imports all the routes
    â”‚   â”‚   â””â”€â”€ ...
    â”‚   â”œâ”€â”€ tools/              # Tools are used to generate the Open API documentation and health check
    â”‚   â”‚   â””â”€â”€ ...
    â”‚   â”œâ”€â”€ utils/              # Functions that are used in multiple places
    â”‚   â”‚   â””â”€â”€ ...
    â”‚   â”œâ”€â”€ app.ts              # Express app with middlewares and routes
    â”‚   â”œâ”€â”€ config.ts           # Configuration file
    â”‚   â””â”€â”€ server.ts           # Server file that starts the app
    â”œâ”€â”€ test/
    â”‚   â”œâ”€â”€ __mocks__/          # Mocks for tests
    â”‚   â””â”€â”€ ...                 # Tests
    â””â”€â”€ ...

<p align="right"><a href="#top">ğŸ”</a></p>

<h2 id="how-to-use">ğŸ’ª  How to use</h2>

You can use this repository as a template by clicking on the `Use this template` button on the top right of the repository page and select the `Create a new repository` option. This will create a new repository with the same files and history as this one.

```bash
# Install dependencies
npm install

# Set up environment variables and fill in the values
cp .env.example .env
code .env # or vim or whatever you prefer

# Set up coveralls repo token
cp .coveralls.example .coveralls.yml
code .coveralls.yml # or vim or whatever you prefer

# Run the development server
npm run dev

# Production build
npm run build

# Run the production server
npm start
```

<p align="right"><a href="#top">ğŸ”</a></p>

<h2 id="docker">ğŸ³ Docker</h2>

```bash
# Build the image
docker build -t {{some-name}} .

# Run the container
docker run -p 3000:3000 {{some-name}}
```

<p align="right"><a href="#top">ğŸ”</a></p>

<h2 id="linting">ğŸ”¦ Linting</h2>

```bash
# Run Linter
npm run lint

# Run Formatter
npm run lint:fix
```

> The linter will run automatically before every commit using [Husky](https://typicode.github.io/husky/).

<p align="right"><a href="#top">ğŸ”</a></p>

<h2 id="testing">ğŸ‘¾ Testing</h2>

```bash
# Run tests
npm run test

# Run tests and generate coverage report
npm run test:coverage

# Run coverage and send report to Coveralls
npm run test:coveralls
```

<p align="right"><a href="#top">ğŸ”</a></p>

<h2 id="coveralls">ğŸ“Š Coveralls</h2>

> If you have a coveralls account, and you have the project synchronized with coveralls, you can use it to generate the jest coverage and send it to coveralls.

The coverage report is generated by [Jest](https://jestjs.io/) and sent to [Coveralls](https://coveralls.io/) but first you need the `repo_token` variable in your `.coveralls.yml` file. The coverage report is generated automatically when you push to the repository, only if you have a coveralls repo token set up and a coveralls profile linked to your github account.

In case you do not want to use [Coveralls](https://coveralls.io/), you must do the following:

- Delete the `coveralls.yml` github action workflow file from the `.github/workflows` folder.
- Remove the `coveralls.example` file from the root of the project.
  - Remove the `.coveralls.yml` file if you have already created it.
- Remove the `test:coveralls` script from the `package.json` file.
  - Remove the `coveralls` package if you have already installed it.

<p align="right"><a href="#top">ğŸ”</a></p>

<h2 id="migration-plan">ğŸ—ï¸ Migration Plan</h2>

A comprehensive migration plan is available in the [`specs/`](./specs/) folder to modernize this API skeleton with:

### ğŸ¯ Target Architecture

- **Hexagonal Architecture** (Ports & Adapters): Clean separation between business logic and infrastructure
- **Onion Architecture**: Dependencies point inward toward the domain
- **Screaming Architecture**: Folder structure organized by business features, not technical layers

### âš¡ Modern Tech Stack

| Current | Target | Benefit |
|---------|--------|---------|
| Express | **Fastify** | 2-3x better performance |
| tsc | **SWC** | 20x faster compilation |
| Jest | **Vitest** | Faster tests, better DX |
| Manual validation | **Zod** | Runtime type safety |
| Console logs | **Winston** | Structured logging |
| - | **Prometheus** | Production metrics |

### ğŸ“š Migration Documents

1. **[00_analisis_situacion_actual.md](./specs/00_analisis_situacion_actual.md)** - Current state analysis
2. **[01_arquitectura_hexagonal.md](./specs/01_arquitectura_hexagonal.md)** - Architecture design
3. **[02_carpetas_versionadas.md](./specs/02_carpetas_versionadas.md)** - API versioning strategy
4. **[03_oportunidades_mejora.md](./specs/03_oportunidades_mejora.md)** - Improvement opportunities
5. **[04_plan_implementacion.md](./specs/04_plan_implementacion.md)** - 8-stage implementation plan
6. **[05_enfoque_hibrido_pragmatico.md](./specs/05_enfoque_hibrido_pragmatico.md)** - Hybrid OOP+FP approach
7. **[README.md](./specs/README.md)** - Executive summary and index

### ğŸ¨ Hybrid Pragmatic Approach

The migration follows a **pragmatic hybrid** of OOP and Functional Programming:

- **Classes** for: Entities, Value Objects, Use Cases, Repositories (structure & DI)
- **Functions** for: DTOs (types), Mappers, Utilities (transformations)
- **Principles**: Immutability, pure functions, composition over inheritance, DDD

### ğŸ“… Implementation Timeline

**Total estimate**: 32-50 days (8 stages)

- Stage 0: Setup (Fastify, SWC, Vitest) - 2-3 days
- Stage 1: Base structure - 3-5 days
- Stage 2: Domain layer - 4-5 days
- Stage 3: Application layer v1 - 4-5 days
- Stage 4: Infrastructure (Fastify) v1 - 5-6 days
- Stage 5: API versioning v2 - 3-4 days
- Stage 6: Observability - 4-5 days
- Stage 7: Optional improvements - 5-10 days
- Stage 8: Cleanup & docs - 2-3 days

### ğŸš¦ Getting Started with Migration

1. Read the executive summary: [`specs/README.md`](./specs/README.md)
2. Review the architecture design: [`specs/01_arquitectura_hexagonal.md`](./specs/01_arquitectura_hexagonal.md)
3. Follow the implementation plan: [`specs/04_plan_implementacion.md`](./specs/04_plan_implementacion.md)
4. Reference the coding patterns: [`specs/05_enfoque_hibrido_pragmatico.md`](./specs/05_enfoque_hibrido_pragmatico.md)

**Status**: Planning phase complete âœ… | Implementation not started

<p align="right"><a href="#top">ğŸ”</a></p>
